---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: longhorn-release
  namespace: longhorn-system
spec:
  chart:
    spec:
      chart: longhorn
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: longhorn-repo
      version: v1.10.1
  interval: 1m0s
  values:
    persistence:
      defaultClass: true
      defaultFsType: ext4

    defaultSettings:
      defaultReplicaCount: 3
      defaultDataPath: /var/lib/longhorn
      snapshotMaxCount: 250
      autoSalvage: true
      allowNodeDrainWithLastHealthyReplica: false
      disableSchedulingOnCordonedNode: true
      storageOverProvisioningPercentage: 100
      guaranteedEngineManagerCPU: 0.25
      guaranteedReplicaManagerCPU: 0.25
      replicaAutoBalance: best-effort
      nodeDownPodDeletionPolicy: delete-both-statefulset-and-deployment-pod
      backupTarget: s3://home-ops-dev-longhorn-backup@hel1/?endpoint=https://hel1.your-objectstorage.com
      backupTargetCredentialSecret: longhorn-backup-s3